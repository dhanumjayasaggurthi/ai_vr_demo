<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Dental AI VR - Immersive Experience</title>
    <meta name="description" content="Fully Interactive VR Dental AI Experience">
    
    <!-- A-Frame VR Framework -->
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    
    <!-- A-Frame Extras (locomotion, controllers) -->
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    
    <!-- A-Frame Environment Component -->
    <script src="https://unpkg.com/aframe-environment-component@1.3.2/dist/aframe-environment-component.min.js"></script>
    
    <!-- A-Frame Hand Tracking -->
    <script src="https://cdn.jsdelivr.net/gh/stewdio/aframe-handtracking@master/dist/aframe-hand-tracking-controls.min.js"></script>
    
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        
        #enter-vr-button {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 30px 60px;
            font-size: 28px;
            font-weight: bold;
            background: linear-gradient(135deg, #00ffff, #0080ff);
            color: #000;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 20px 60px rgba(0, 255, 255, 0.6);
            transition: all 0.3s;
            z-index: 1000;
            font-family: 'Arial', sans-serif;
            letter-spacing: 2px;
        }
        
        #enter-vr-button:hover {
            transform: translate(-50%, -50%) scale(1.05);
            box-shadow: 0 25px 80px rgba(0, 255, 255, 0.8);
        }
        
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a1a 0%, #000000 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 999;
            color: #00ffff;
            font-family: 'Arial', sans-serif;
        }
        
        #loading-screen h1 {
            font-size: 48px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #00ffff 0%, #0080ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .loader {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(0, 255, 255, 0.3);
            border-top: 4px solid #00ffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        #instructions {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 20, 40, 0.9);
            padding: 15px 30px;
            border-radius: 20px;
            border: 2px solid rgba(0, 255, 255, 0.5);
            color: #00ffff;
            font-family: 'Arial', sans-serif;
            text-align: center;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
    </style>
</head>

<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <h1>DENTAL AI VR</h1>
        <div class="loader"></div>
        <p style="margin-top: 20px; font-size: 18px;">Loading immersive experience...</p>
    </div>
    
    <!-- Instructions Overlay -->
    <div id="instructions" style="display: none;">
        <strong>Controls:</strong><br>
        üëã Grab objects with hand tracking<br>
        üéÆ Or use controllers (grip + trigger)<br>
        üö∂ Walk with thumbstick / teleport with A button
    </div>

    <!-- A-Frame VR Scene -->
    <a-scene
        background="color: #000"
        loading-screen="enabled: false"
        vr-mode-ui="enabled: true"
    >
        <!-- Asset Management -->
        <a-assets>
            <!-- Audio Files (narration generated by openai_tts.py) -->
            <audio id="narration1" src="audio_narrations/narration_scene1.mp3" preload="auto"></audio>
            <audio id="narration2" src="audio_narrations/narration_scene2.mp3" preload="auto"></audio>
            <audio id="narration3" src="audio_narrations/narration_scene3.mp3" preload="auto"></audio>
            <audio id="narration4" src="audio_narrations/narration_scene4.mp3" preload="auto"></audio>
            <audio id="narration5" src="audio_narrations/narration_scene5.mp3" preload="auto"></audio>
            
            <!-- Background ambient music -->
            <audio id="ambient-music" src="audio/background_music.mp3" preload="auto" loop></audio>
        </a-assets>

        <!-- Immersive 360¬∞ Environment -->
        <a-entity 
            environment="
                preset: starry;
                dressingAmount: 100;
                dressingColor: #00ffff;
                groundColor: #0a1428;
                groundColor2: #050a14;
                horizonColor: #1a2f4a;
                skyType: gradient;
                fog: 0.6;
                grid: cross;
                gridColor: #00ffff;
            "
        ></a-entity>

        <!-- Lighting -->
        <a-entity light="type: ambient; color: #445; intensity: 0.5"></a-entity>
        <a-entity light="type: point; color: #00ffff; intensity: 1; distance: 50" position="0 5 0"></a-entity>
        <a-entity light="type: point; color: #0080ff; intensity: 0.8; distance: 40" position="5 3 -5"></a-entity>
        <a-entity light="type: point; color: #00ffff; intensity: 0.8; distance: 40" position="-5 3 5"></a-entity>

        <!-- Player Rig with Camera and Controllers -->
        <a-entity 
            id="player-rig" 
            movement-controls="speed: 0.15; fly: false"
            position="0 0 5"
        >
            <!-- VR Camera -->
            <a-entity 
                id="camera" 
                camera 
                position="0 1.6 0"
                look-controls="pointerLockEnabled: false"
            >
                <!-- Cursor for non-VR mode -->
                <a-cursor
                    fuse="false"
                    raycaster="objects: .clickable"
                    material="color: #00ffff; shader: flat"
                ></a-cursor>
            </a-entity>

            <!-- Left Hand / Controller -->
            <a-entity 
                id="left-hand"
                hand-tracking-controls="hand: left"
                oculus-touch-controls="hand: left"
                vive-controls="hand: left"
                valve-index-controls="hand: left"
                laser-controls
                raycaster="objects: .interactive; far: 10; lineColor: #00ffff; lineOpacity: 0.5"
            >
                <a-entity 
                    geometry="primitive: sphere; radius: 0.02"
                    material="color: #00ffff; shader: flat; opacity: 0.8"
                ></a-entity>
            </a-entity>

            <!-- Right Hand / Controller -->
            <a-entity 
                id="right-hand"
                hand-tracking-controls="hand: right"
                oculus-touch-controls="hand: right"
                vive-controls="hand: right"
                valve-index-controls="hand: right"
                laser-controls
                raycaster="objects: .interactive; far: 10; lineColor: #00ffff; lineOpacity: 0.5"
            >
                <a-entity 
                    geometry="primitive: sphere; radius: 0.02"
                    material="color: #00ffff; shader: flat; opacity: 0.8"
                ></a-entity>
            </a-entity>
        </a-entity>

        <!-- SCENE 1: Welcome Portal -->
        <a-entity id="welcome-area" position="0 0 0">
            <!-- Holographic Title -->
            <a-text
                value="THE FUTURE\nOF DENTAL MEDICINE"
                align="center"
                width="8"
                color="#00ffff"
                position="0 3 -5"
                animation="property: scale; to: 1.1 1.1 1.1; dur: 2000; easing: easeInOutSine; loop: true; dir: alternate"
            ></a-text>
            
            <!-- Floating particles -->
            <a-entity id="particles" position="0 2 -5">
                <a-entity 
                    geometry="primitive: sphere; radius: 0.05"
                    material="color: #00ffff; shader: flat; opacity: 0.8"
                    position="0 0 0"
                    animation="property: position; to: 0 2 0; dur: 3000; easing: easeInOutSine; loop: true; dir: alternate"
                ></a-entity>
                <a-entity 
                    geometry="primitive: sphere; radius: 0.05"
                    material="color: #0080ff; shader: flat; opacity: 0.8"
                    position="1 0 0"
                    animation="property: position; to: 1 2.5 0; dur: 3500; easing: easeInOutSine; loop: true; dir: alternate"
                ></a-entity>
                <a-entity 
                    geometry="primitive: sphere; radius: 0.05"
                    material="color: #00ffff; shader: flat; opacity: 0.8"
                    position="-1 0 0"
                    animation="property: position; to: -1 1.8 0; dur: 3200; easing: easeInOutSine; loop: true; dir: alternate"
                ></a-entity>
            </a-entity>
            
            <!-- Interactive "Start" button -->
            <a-entity
                id="start-button"
                class="interactive clickable"
                geometry="primitive: box; width: 1; height: 0.4; depth: 0.1"
                material="color: #00ffff; shader: flat; opacity: 0.9"
                position="0 1.6 -3"
                text="value: ENTER VR EXPERIENCE; align: center; width: 2; color: #000"
                animation="property: rotation; to: 0 360 0; dur: 20000; easing: linear; loop: true"
            ></a-entity>
            
            <!-- Spatial audio for narration -->
            <a-entity 
                id="narrator-scene1"
                position="0 2 -4"
                sound="src: #narration1; autoplay: false; volume: 1; positional: true; refDistance: 5"
            ></a-entity>
        </a-entity>

        <!-- SCENE 2: AI Assistant Room -->
        <a-entity id="ai-room" position="10 0 -10" visible="false">
            <!-- 3D AI Avatar (grabbable!) -->
            <a-entity 
                id="ai-avatar"
                class="interactive"
                position="0 1.5 -3"
                grabbable
            >
                <!-- Avatar head -->
                <a-sphere 
                    radius="0.3" 
                    color="#1a6d8d"
                    material="shader: flat; opacity: 0.9"
                    animation="property: scale; to: 1.05 1.05 1.05; dur: 2000; easing: easeInOutSine; loop: true; dir: alternate"
                >
                    <!-- Glowing eyes -->
                    <a-sphere position="-0.1 0.05 0.25" radius="0.04" color="#00ffff" material="shader: flat"></a-sphere>
                    <a-sphere position="0.1 0.05 0.25" radius="0.04" color="#00ffff" material="shader: flat"></a-sphere>
                </a-sphere>
                
                <!-- Avatar body -->
                <a-cylinder 
                    height="0.8" 
                    radius="0.25" 
                    color="#1a6d8d"
                    material="shader: flat; opacity: 0.9"
                    position="0 -0.6 0"
                ></a-cylinder>
                
                <!-- Lab coat -->
                <a-box 
                    width="0.6" 
                    height="0.7" 
                    depth="0.2"
                    color="#ffffff"
                    material="opacity: 0.8"
                    position="0 -0.6 0"
                ></a-box>
                
                <!-- Holographic ring around avatar -->
                <a-ring
                    radius-inner="0.5"
                    radius-outer="0.6"
                    color="#00ffff"
                    material="shader: flat; opacity: 0.3; side: double"
                    position="0 0 0"
                    rotation="-90 0 0"
                    animation="property: rotation; to: -90 360 0; dur: 10000; easing: linear; loop: true"
                ></a-ring>
            </a-entity>
            
            <!-- Text label -->
            <a-text
                value="Dr. AI Assistant\n(Grab me!)"
                align="center"
                width="3"
                color="#00ffff"
                position="0 2.5 -3"
            ></a-text>
            
            <!-- Narration source -->
            <a-entity 
                position="0 2 -3"
                sound="src: #narration2; autoplay: false; volume: 1; positional: true"
            ></a-entity>
        </a-entity>

        <!-- SCENE 3: X-Ray Analysis Lab -->
        <a-entity id="xray-lab" position="-10 0 -10" visible="false">
            <!-- Holographic X-Ray Panel (grabbable and pushable!) -->
            <a-entity 
                id="xray-panel"
                class="interactive"
                position="0 2 -3"
                grabbable
            >
                <a-plane 
                    width="2" 
                    height="1.5"
                    color="#0a2838"
                    material="shader: flat; opacity: 0.9"
                >
                    <!-- X-ray image simulation -->
                    <a-circle 
                        radius="0.2" 
                        color="#80b0c0"
                        position="-0.5 0.3 0.01"
                        material="shader: flat; opacity: 0.7"
                    ></a-circle>
                    <a-circle 
                        radius="0.2" 
                        color="#80b0c0"
                        position="0.5 0.3 0.01"
                        material="shader: flat; opacity: 0.7"
                    ></a-circle>
                    
                    <!-- Detection markers (animated) -->
                    <a-ring
                        radius-inner="0.18"
                        radius-outer="0.22"
                        color="#ff4444"
                        position="0.5 0.3 0.02"
                        material="shader: flat"
                        animation="property: scale; to: 1.3 1.3 1.3; dur: 1000; easing: easeInOutSine; loop: true; dir: alternate"
                    ></a-ring>
                </a-plane>
                
                <!-- Frame -->
                <a-box 
                    width="2.1" 
                    height="1.6" 
                    depth="0.05"
                    color="#00ffff"
                    material="shader: flat; opacity: 0.3"
                    position="0 0 -0.03"
                ></a-box>
            </a-entity>
            
            <!-- Scanning laser effect -->
            <a-plane
                width="2"
                height="0.02"
                color="#00ffff"
                material="shader: flat; opacity: 0.8"
                position="0 2.7 -2.99"
                animation="property: position; from: 0 2.7 -2.99; to: 0 1.3 -2.99; dur: 2000; easing: linear; loop: true"
            ></a-plane>
            
            <!-- Info text -->
            <a-text
                value="AI X-Ray Analysis\nDetecting: Tooth 14 anomaly"
                align="center"
                width="3"
                color="#00ff88"
                position="0 3.2 -3"
            ></a-text>
            
            <!-- Narration -->
            <a-entity 
                position="0 2 -2"
                sound="src: #narration3; autoplay: false; volume: 1; positional: true"
            ></a-entity>
        </a-entity>

        <!-- SCENE 4: Implant Planning Studio -->
        <a-entity id="implant-studio" position="0 0 -20" visible="false">
            <!-- 3D Tooth Model (fully grabbable and rotatable!) -->
            <a-entity 
                id="tooth-model"
                class="interactive"
                position="0 2 -3"
                grabbable
                animation="property: rotation; to: 0 360 0; dur: 10000; easing: linear; loop: true"
            >
                <!-- Tooth crown -->
                <a-cone
                    height="0.8"
                    radius-bottom="0.3"
                    radius-top="0.15"
                    color="#e0f0ff"
                    material="shader: flat; opacity: 0.9"
                    position="0 0.4 0"
                ></a-cone>
                
                <!-- Tooth root -->
                <a-cone
                    height="0.6"
                    radius-bottom="0.15"
                    radius-top="0.05"
                    color="#c0d8e8"
                    material="shader: flat; opacity: 0.9"
                    position="0 -0.3 0"
                ></a-cone>
                
                <!-- Implant post (glowing) -->
                <a-cylinder
                    height="0.8"
                    radius="0.08"
                    color="#00ff88"
                    material="shader: flat; opacity: 0.95"
                    position="0 -0.1 0"
                    animation="property: material.opacity; from: 0.7; to: 1; dur: 1000; easing: easeInOutSine; loop: true; dir: alternate"
                ></a-cylinder>
                
                <!-- Measurement lines -->
                <a-entity position="0 0 0">
                    <a-text value="4.2mm" align="center" width="1" color="#00ffff" position="0.5 0 0"></a-text>
                    <a-text value="12mm" align="center" width="1" color="#00ffff" position="0 0 0.5"></a-text>
                </a-entity>
            </a-entity>
            
            <!-- Title -->
            <a-text
                value="Virtual Implant Planning\n(Grab and rotate the tooth!)"
                align="center"
                width="4"
                color="#00ffff"
                position="0 3.5 -3"
            ></a-text>
            
            <!-- Narration -->
            <a-entity 
                position="0 2.5 -2"
                sound="src: #narration4; autoplay: false; volume: 1; positional: true"
            ></a-entity>
        </a-entity>

        <!-- SCENE 5: Final Reveal -->
        <a-entity id="finale" position="0 0 -30" visible="false">
            <!-- Massive 3D Logo -->
            <a-text
                value="DENTAL AI VR"
                align="center"
                width="12"
                color="#00ffff"
                position="0 3 -8"
                animation="property: scale; from: 0.5 0.5 0.5; to: 1 1 1; dur: 2000; easing: easeOutElastic"
            ></a-text>
            
            <a-text
                value="Meta Quest 3 S"
                align="center"
                width="6"
                color="#ffffff"
                position="0 2 -8"
                animation="property: opacity; from: 0; to: 1; dur: 1500; delay: 500"
            ></a-text>
            
            <a-text
                value="THE FUTURE IS HERE"
                align="center"
                width="8"
                color="#00ff88"
                position="0 1 -8"
                animation="property: opacity; from: 0; to: 1; dur: 1500; delay: 1000"
            ></a-text>
            
            <!-- Explosion of particles -->
            <a-entity id="finale-particles" position="0 2 -8">
                <!-- Multiple glowing orbs flying outward -->
            </a-entity>
            
            <!-- Narration -->
            <a-entity 
                position="0 2.5 -7"
                sound="src: #narration5; autoplay: false; volume: 1; positional: true"
            ></a-entity>
        </a-entity>

        <!-- Teleportation targets (for movement) -->
        <a-entity id="teleport-targets">
            <a-circle 
                class="interactive"
                radius="0.5" 
                color="#00ffff"
                material="shader: flat; opacity: 0.3"
                rotation="-90 0 0"
                position="10 0.01 -10"
            ></a-circle>
            <a-circle 
                class="interactive"
                radius="0.5" 
                color="#00ffff"
                material="shader: flat; opacity: 0.3"
                rotation="-90 0 0"
                position="-10 0.01 -10"
            ></a-circle>
            <a-circle 
                class="interactive"
                radius="0.5" 
                color="#00ffff"
                material="shader: flat; opacity: 0.3"
                rotation="-90 0 0"
                position="0 0.01 -20"
            ></a-circle>
        </a-entity>

        <!-- Background ambient music (spatial audio) -->
        <a-entity 
            position="0 5 0"
            sound="src: #ambient-music; autoplay: false; volume: 0.3; positional: true; loop: true"
        ></a-entity>
    </a-scene>

    <!-- JavaScript for Interactivity -->
    <script>
        // Register grabbable component
        AFRAME.registerComponent('grabbable', {
            init: function() {
                this.grabbed = false;
                this.hand = null;
                
                this.el.addEventListener('triggerdown', (evt) => {
                    if (!this.grabbed) {
                        this.grabbed = true;
                        this.hand = evt.target;
                        console.log('Grabbed:', this.el.id);
                    }
                });
                
                this.el.addEventListener('triggerup', (evt) => {
                    if (this.grabbed && evt.target === this.hand) {
                        this.grabbed = false;
                        this.hand = null;
                        console.log('Released:', this.el.id);
                    }
                });
            },
            
            tick: function() {
                if (this.grabbed && this.hand) {
                    // Follow hand position
                    const handPosition = this.hand.object3D.position;
                    this.el.object3D.position.copy(handPosition);
                }
            }
        });

        // Scene management
        let currentScene = 0;
        const scenes = ['welcome-area', 'ai-room', 'xray-lab', 'implant-studio', 'finale'];
        const narrators = ['narrator-scene1', null, null, null, null];
        
        function showScene(index) {
            // Hide all scenes
            scenes.forEach((sceneId, i) => {
                const scene = document.getElementById(sceneId);
                if (scene) {
                    scene.setAttribute('visible', i === index);
                }
            });
            
            // Play narration if available
            const narratorId = `narrator-scene${index + 1}`;
            const narrator = document.querySelector(`[sound][src="#narration${index + 1}"]`);
            if (narrator) {
                narrator.components.sound.playSound();
            }
            
            console.log(`Showing scene ${index + 1}: ${scenes[index]}`);
        }

        // Handle start button click
        document.addEventListener('DOMContentLoaded', () => {
            const scene = document.querySelector('a-scene');
            const loadingScreen = document.getElementById('loading-screen');
            const instructions = document.getElementById('instructions');
            
            scene.addEventListener('loaded', () => {
                loadingScreen.style.display = 'none';
                instructions.style.display = 'block';
                
                // Auto-hide instructions after 5 seconds
                setTimeout(() => {
                    instructions.style.opacity = '0';
                    setTimeout(() => {
                        instructions.style.display = 'none';
                    }, 500);
                }, 5000);
            });
            
            // Start button interaction
            const startButton = document.getElementById('start-button');
            if (startButton) {
                startButton.addEventListener('click', () => {
                    currentScene = 1;
                    showScene(currentScene);
                    
                    // Start background music
                    const music = document.querySelector('[sound][src="#ambient-music"]');
                    if (music) {
                        music.components.sound.playSound();
                    }
                });
            }
            
            // Keyboard navigation (for testing)
            window.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowRight') {
                    currentScene = (currentScene + 1) % scenes.length;
                    showScene(currentScene);
                } else if (e.key === 'ArrowLeft') {
                    currentScene = (currentScene - 1 + scenes.length) % scenes.length;
                    showScene(currentScene);
                }
            });
        });

        // Log instructions
        console.log('%cüéÆ VR CONTROLS', 'font-size: 20px; color: #00ffff; font-weight: bold');
        console.log('üëã Hand Tracking: Grab objects with pinch gesture');
        console.log('üéÆ Controllers: Grip + Trigger to grab');
        console.log('üö∂ Movement: Thumbstick or teleport (A button)');
        console.log('‚å®Ô∏è  Keyboard: Arrow keys to navigate scenes (desktop testing)');
    </script>
</body>
</html>
